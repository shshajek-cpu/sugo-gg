# 랭킹 기능 점검 요청서

## 프로젝트 정보
- **프로젝트명**: AION 2 Info Hub (HitOn)
- **프로젝트 경로**: `c:\projects\hiton2\frontend`
- **프레임워크**: Next.js 14 (App Router) + TypeScript
- **백엔드**: Supabase (PostgreSQL)

---

## 점검 대상 파일

### 1. API 엔드포인트
**파일 경로**: `src/app/api/ranking/route.ts`

**주요 기능**:
- 캐릭터 랭킹 데이터 조회
- 필터링: 서버, 종족, 직업, 검색어
- 정렬: HITON 전투력(noa), 전투력(cp), 어비스 포인트(ap), 아이템 레벨(il)
- 페이지네이션: page, limit 파라미터

**확인 사항**:
- [ ] 필터 파라미터가 올바르게 쿼리에 적용되는지
- [ ] 종족 필터가 한글/영문 모두 처리되는지 (`천족`/`ELYOS`, `마족`/`ASMODIANS`)
- [ ] 정렬이 타입별로 올바르게 적용되는지
- [ ] 페이지네이션이 정확히 작동하는지
- [ ] Rate Limiting이 적용되어 있는지

---

### 2. 프론트엔드 컴포넌트
**파일 경로**: `src/app/components/ranking/RankingTable.tsx`

**주요 기능**:
- `/api/ranking` 엔드포인트 호출
- URL 파라미터에서 필터 값 읽기
- 순위 변동 표시 (상승/하락/신규/유지)
- 티어 뱃지 표시 (Bronze ~ Diamond)
- "더보기" 버튼으로 추가 데이터 로드

**확인 사항**:
- [ ] API 호출 시 필터가 올바르게 전달되는지
- [ ] `noa` → `hiton` 타입 매핑이 정확한지
- [ ] 순위 변동 계산 로직 (`getRankChange`)이 정확한지
- [ ] 티어 계산 로직이 정확한지 (1등 기준 상대 평가)
- [ ] 로딩/에러 상태 처리가 적절한지

---

### 3. 필터 UI
**파일 경로**: `src/app/components/ranking/RankingLayoutClient.tsx` (추정)

**확인 사항**:
- [ ] 서버 선택 드롭다운이 작동하는지
- [ ] 종족 선택 드롭다운이 작동하는지
- [ ] 직업 선택 드롭다운이 작동하는지
- [ ] 검색 입력이 작동하는지
- [ ] 필터 변경 시 URL 파라미터가 업데이트되는지

---

### 4. 로딩 UI
**파일 경로**: `src/app/ranking/loading.tsx`

**확인 사항**:
- [ ] 페이지 로딩 시 스켈레톤 UI가 표시되는지
- [ ] 스타일이 기존 테이블과 일관성 있는지

---

## 관련 파일 목록

| 파일 경로 | 설명 |
|-----------|------|
| `src/app/api/ranking/route.ts` | 랭킹 API 엔드포인트 |
| `src/app/components/ranking/RankingTable.tsx` | 랭킹 테이블 컴포넌트 |
| `src/app/components/ranking/Ranking.module.css` | 랭킹 스타일 |
| `src/app/ranking/layout.tsx` | 랭킹 페이지 레이아웃 |
| `src/app/ranking/loading.tsx` | 로딩 스켈레톤 |
| `src/app/ranking/noa/page.tsx` | HITON 랭킹 페이지 |
| `src/app/ranking/cp/page.tsx` | 전투력 랭킹 페이지 |
| `src/app/ranking/content/page.tsx` | 콘텐츠 랭킹 페이지 |
| `src/app/constants/servers.ts` | 서버 매핑 상수 |
| `src/types/character.ts` | 캐릭터 타입 정의 |
| `src/app/utils/combatPower.ts` | 티어 계산 유틸리티 |
| `src/lib/rateLimit.ts` | Rate Limiting 유틸리티 |

---

## 테스트 시나리오

### 1. 기본 조회
1. `/ranking/noa` 페이지 접속
2. 데이터가 50개씩 로드되는지 확인
3. 순위, 캐릭터명, 서버, 종족, 전투력이 표시되는지 확인

### 2. 필터링
1. 서버 드롭다운에서 특정 서버 선택
2. URL에 `?server=1001` 형태로 파라미터가 추가되는지 확인
3. 해당 서버의 캐릭터만 표시되는지 확인

### 3. 페이지네이션
1. "더보기" 버튼 클릭
2. 추가 50개 데이터가 로드되는지 확인
3. 기존 데이터 아래에 추가되는지 확인

### 4. 순위 변동
1. `prev_rank` 값이 있는 캐릭터의 순위 변동 표시 확인
2. 상승(▲), 하락(▼), 유지(-), 신규(NEW) 표시 확인

---

## 주의 사항

1. **환경 변수 필요**
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY` 또는 `SUPABASE_SERVICE_ROLE_KEY`

2. **Supabase 테이블 구조**
   - 테이블명: `characters`
   - 주요 컬럼: `character_id`, `name`, `server_id`, `race_name`, `class_name`, `noa_score`, `combat_power`, `item_level`, `prev_rank`, `prev_tier`, `profile_image`

3. **디자인 가이드라인**
   - Brand Color: Red (#D92B4B), Amber (#F59E0B)
   - 다크 테마 기반
   - Glassmorphism 스타일 적용

---

## 요청 사항

위 체크리스트를 기반으로 랭킹 기능이 정상 작동하는지 점검해주세요.
문제가 발견되면 수정 방안과 함께 보고해주세요.
