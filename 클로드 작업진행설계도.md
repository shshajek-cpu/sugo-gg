# [AION2] 어비스 랭킹 수집 및 상세 정보 연동 설계도

## 1. 개요 (Goal)
AION2 공식 홈페이지의 '어비스 랭킹' 페이지(https://aion2.plaync.com/ko-kr/ranking/abyss)에서 캐릭터 정보를 수집합니다.
전 서버 대상, 천족/마족을 구분하여 상위 5명의 캐릭터 정보를 가져오고, 이 캐릭터들의 상세 정보(장비, 스탯 등)를 기존 시스템과 연동하여 웹사이트에서 확인할 수 있도록 합니다.

## 2. 사용자 리뷰 필요 사항 (User Review Required)
> [!IMPORTANT]
> **수집 속도 및 차단 주의**: 짧은 시간에 많은 캐릭터(랭킹 전체 등)를 상세 조회할 경우 IP 차단 위험이 있습니다. 이번 테스트에서는 **Top 5**로 제한하여 진행합니다.

## 3.  구현 상세 (Proposed Changes)

### 3.1. 백엔드 (Backend)
#### [MODIFY] `backend/app/aion2_adapter.py`
*   `fetch_abyss_rankings(server, race, limit=5)` 메서드 추가.
*   Playwright를 사용하여 랭킹 페이지 접속 및 필터 조작.
    *   서버 선택 드롭다운 제어.
    *   종족(천족/마족) 탭 제어.
*   랭킹 리스트 파싱: 순위, 캐릭터명, 서버, 직업, 레벨 등 추출.
*   **상세 정보 연동**: 리스트에서 확보한 `(서버, 캐릭터명)`을 사용하여 기존 `get_character_detail` 로직을 트리거하거나, DB에 기본 정보를 우선 저장.

#### [MODIFY] `backend/app/routes/rankings.py` (New or Modify)
*   랭킹 수집을 트리거하는 API 엔드포인트 추가 (예: `POST /api/rankings/fetch`).
*   천족/마족, 서버 파라미터 지원.

### 3.2. 데이터베이스 (Database)
*   기존 `characters` 테이블 활용.
*   수집된 랭킹 정보가 `characters` 테이블에 없으면 새로 생성(`is_dummy=True` 상태일 수 있음), 있으면 업데이트.

### 3.3. 프론트엔드 (Frontend)
*   이번 요청의 핵심은 "상세보기 연동"이므로, 랭킹 수집 후 해당 캐릭터를 검색했을 때 상세 정보가 잘 나오는지 확인하는 것이 우선입니다.
*   필요 시 '랭킹 수집 테스트' 버튼을 임시로 추가하거나, Swagger UI를 통해 테스트 진행.

## 4. 검증 계획 (Verification Plan)
### 자동화 테스트
*   Playwright 스크립트를 통해 실제 랭킹 페이지 접근 및 데이터 추출 확인.
*   추출된 캐릭터 이름으로 상세 조회 API 호출 성공 여부 확인.

### 수동 검증
1.  API를 통해 랭킹 Top 5 수집 요청.
2.  수집된 캐릭터 이름으로 웹사이트 내 검색.
3.  상세 페이지(스탯, 장비 등) 정상 출력 확인.
